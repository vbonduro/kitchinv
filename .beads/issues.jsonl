{"id":"kitchinv-172","title":"Publish a CI container image","description":"Each CI job currently installs tools from scratch on every run (golangci-lint, staticcheck, govulncheck, Go, Node, Playwright + Chromium). This adds minutes of setup time and risks flaky installs from upstream sources. Build and publish a Docker image that has all CI dependencies pre-installed, then update .github/workflows/ci.yml to use it as the job container. The image should include: Go (pinned to go.mod version), golangci-lint v2.10.1, staticcheck, govulncheck, Node 22, Playwright Chromium with system deps. Consider publishing to ghcr.io (GitHub Container Registry) using a separate workflow that rebuilds on changes to the Dockerfile or a lockfile of tool versions. The image should be versioned/tagged so CI jobs pin to a specific digest rather than latest.","status":"open","priority":3,"issue_type":"feature","owner":"vbonduro@gmail.com","created_at":"2026-02-22T16:11:42Z","created_by":"Vincent Bonduro","updated_at":"2026-02-22T16:11:42Z","dependencies":[{"issue_id":"kitchinv-172","depends_on_id":"kitchinv-6nr","type":"blocks","created_at":"2026-02-22T11:13:50Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-25e","title":"Final quality gate: make all green","description":"Run 'make all' which executes lint + vet + staticcheck + test + build. Fix any issues found by golangci-lint, go vet, or staticcheck. Ensure zero lint errors and all tests pass with -race flag. Verify 'make docker-build' succeeds. This is the final sign-off step before the project is ready for use.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:05:08Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:23:47Z","closed_at":"2026-02-20T03:23:47Z","close_reason":"Closed","dependencies":[{"issue_id":"kitchinv-25e","depends_on_id":"kitchinv-27b","type":"blocks","created_at":"2026-02-19T22:05:28Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-27b","title":"Dockerfile and docker-compose","description":"Create multi-stage Dockerfile: builder stage uses golang:1.26-alpine with CGO_ENABLED=0 (works because modernc.org/sqlite is pure Go), runtime stage uses alpine:3.21 with ca-certificates and tzdata. Create docker-compose.yml with kitchinv service (port 8080, kitchinv-data volume at /data) and ollama sidecar service (ollama/ollama:latest, ollama-models volume). Add make docker-build, make docker-up, make docker-pull-model targets to Makefile.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:05:05Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:23:47Z","closed_at":"2026-02-20T03:23:47Z","close_reason":"Closed","dependencies":[{"issue_id":"kitchinv-27b","depends_on_id":"kitchinv-orp","type":"blocks","created_at":"2026-02-19T22:05:28Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-2n4","title":"Allow user to edit inventory table","description":"Add inline or modal editing capability to the inventory table so users can update item fields (name, quantity, unit, etc.) directly from the table view.","status":"open","priority":2,"issue_type":"feature","owner":"vbonduro@gmail.com","created_at":"2026-02-22T02:33:51Z","created_by":"Vincent Bonduro","updated_at":"2026-02-22T02:33:51Z","dependencies":[{"issue_id":"kitchinv-2n4","depends_on_id":"kitchinv-syg","type":"blocks","created_at":"2026-02-21T21:33:57Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-36v","title":"Design frontend status indicator","description":"Design the UI for the vision system status indicator in the banner. Should show connected/disconnected/checking states with appropriate color and iconography consistent with the Cold Storage dark theme. No code yet — just the design spec.","status":"open","priority":2,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-21T03:51:46Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T03:51:46Z","dependencies":[{"issue_id":"kitchinv-36v","depends_on_id":"kitchinv-gf0","type":"blocks","created_at":"2026-02-20T22:51:56Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-3jj","title":"Allow re-analyzing the same photo without re-uploading","description":"Add a Re-analyse button on the area detail page that triggers analysis on the already-uploaded photo without requiring the user to select the file again. Needs a new endpoint or parameter to trigger analysis on the stored photo.","status":"open","priority":2,"issue_type":"feature","owner":"vbonduro@gmail.com","created_at":"2026-02-21T03:55:38Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T03:55:38Z"}
{"id":"kitchinv-3to","title":"Implement versioning, changelog, and semver tagging in CI","description":"Research and implement a versioning strategy for kitchinv. Goals: (1) conventional commits enforced (commitizen or commitlint), (2) automatic changelog generation from commit history, (3) automatic semver tagging on merge to main via CI. Evaluate options: commitizen, semantic-release, release-please, or a lightweight Go-native approach. Must integrate with the existing GitHub Actions CI pipeline.","notes":"Options to evaluate:\n\n- release-please (Google): GitHub Action that reads conventional commits, bumps semver, generates CHANGELOG.md, and opens a release PR. Very low friction, no local tooling required. Best fit for this repo given the PR approval workflow — the release PR acts as a natural gate.\n- semantic-release: Fully automated, runs in CI, handles tagging + GitHub release + changelog. More config but more powerful. Skips the release PR step so less aligned with the manual approval process.\n- commitizen: Enforces conventional commit format at commit time via an interactive prompt. Usually paired with one of the above for the release side. Could replace free-form commit messages.\n- git-cliff: Lightweight Rust-based changelog generator. Easy to drop into a Makefile or CI step. Good option if we want changelog generation without the full release automation.\n\nRecommendation: release-please for release automation + commitizen for enforcing conventional commits at write time.","status":"open","priority":3,"issue_type":"feature","owner":"vbonduro@gmail.com","created_at":"2026-02-21T04:18:04Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T04:18:41Z"}
{"id":"kitchinv-44t","title":"Config package","description":"Implement internal/config/config.go with Load() that reads env vars and applies defaults. Write table-driven config_test.go using t.Setenv. Env vars: LISTEN_ADDR, DB_PATH, VISION_BACKEND, OLLAMA_HOST, OLLAMA_MODEL, CLAUDE_API_KEY, CLAUDE_MODEL, PHOTO_BACKEND, PHOTO_LOCAL_PATH.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:04:39Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:17:14Z","closed_at":"2026-02-20T03:17:14Z","close_reason":"Closed","dependencies":[{"issue_id":"kitchinv-44t","depends_on_id":"kitchinv-74e","type":"blocks","created_at":"2026-02-19T22:05:25Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-49a","title":"Area list not updated dynamically when adding a new area","description":"When creating a new area via the dropdown form, the HTMX response returns an empty body because renderPartial executes tmpl.Templates()[0] which is the unnamed root template, not the named 'area_card' define block. The new area card is never inserted into .area-list, so the user sees nothing until they refresh. Fix renderPartial to execute the named template by name, or restructure the partial to not use a define block.","status":"open","priority":2,"issue_type":"bug","owner":"vbonduro@gmail.com","created_at":"2026-02-21T20:48:56Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T20:48:56Z"}
{"id":"kitchinv-4fc","title":"Stream vision analysis results to browser in real-time","description":"Replace the current fire-and-wait approach with streaming. Switch the Ollama adapter from stream:false to stream:true, parse tokens incrementally as they arrive, and push results to the browser via SSE or chunked transfer. Items should fade in one-by-one as they are parsed from the stream. Covers: (1) streaming Ollama adapter, (2) SSE or chunked HTTP handler, (3) frontend JS to consume the stream and animate items fading in as each line completes.","status":"closed","priority":2,"issue_type":"feature","owner":"vbonduro@gmail.com","created_at":"2026-02-21T03:53:56Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T22:46:48Z","closed_at":"2026-02-21T22:46:48Z","close_reason":"Implemented and merged via PR #5"}
{"id":"kitchinv-5mw","title":"Photo preview missing and analysis state lost on navigation","description":"Two related issues on the area detail page:\n\n1. Photo preview: When the user selects a file and hits Analyse, the photo should appear in the photo block immediately. Currently createObjectURL is called after form submit but the image does not render reliably. The photo should appear as soon as the file is selected (onchange), not onsubmit.\n\n2. Analysis state not persisted across navigation: The streaming analysis runs entirely in frontend JS (fetch + ReadableStream). If the user navigates away mid-analysis and returns, the stream is dead and the page shows no indication that analysis was/is in progress. The server continues writing items to the DB, but the frontend loses all state.\n\nFix plan:\n- Move photo preview to the file input onchange handler so it shows immediately on selection, before the user even clicks Analyse.\n- For navigation resilience: on page load, check if there is a photo but zero items for this area (a signal that analysis may be in progress or recently completed). If so, poll or re-fetch the item list after a short delay. Alternatively, persist the in-progress state in sessionStorage keyed by areaID and resume showing the spinner + item list on re-load until items are confirmed present.","status":"closed","priority":2,"issue_type":"bug","owner":"vbonduro@gmail.com","created_at":"2026-02-21T20:51:28Z","created_by":"Vincent Bonduro","updated_at":"2026-02-22T15:03:02Z","closed_at":"2026-02-22T15:03:02Z","close_reason":"Fixed in PR #9: photo preview onchange, mobile file picker (CSS display:none, capture attr), context cancellation on navigation, sessionStorage replaced with server-driven polling, areas list analysing state"}
{"id":"kitchinv-6be","title":"Structured JSON prompt with error codes for vision response","description":"## Problem\n\nThe current vision prompt asks for plain-text pipe-delimited output (name | quantity | notes). This is fragile:\n- The model can drift from the format (prefixes like 'Here are the items:', numbered lists, etc.)\n- There is no way to distinguish 'no food found' from a parse failure\n- Partial failures (one item the model isn't sure about) are silently dropped or garbled\n- parse.go has ad-hoc heuristics to skip header lines\n\n## Goal\n\nChange AnalysisPrompt (internal/vision/vision.go) to request a JSON response with explicit status codes so parse errors and 'no items found' cases are surfaced cleanly.\n\n## Proposed response schema\n\n```json\n{\n  \"status\": \"ok\" | \"no_items\" | \"not_food\" | \"unclear\",\n  \"items\": [\n    {\n      \"name\": \"string\",\n      \"quantity\": \"string or null\",\n      \"notes\": \"string or null\"\n    }\n  ]\n}\n```\n\nStatus codes:\n- ok        – one or more items found; items array is populated\n- no_items  – image is a valid food storage area but nothing is visible/identifiable\n- not_food  – image does not appear to be a food storage area\n- unclear   – image is too blurry, dark, or otherwise unreadable\n\n## Implementation plan\n\n1. Update AnalysisPrompt in vision.go to request the JSON schema above\n2. Replace ParseResponse and ParseLine in parse.go with JSON-aware equivalents:\n   - ParseJSONResponse(raw string) ([]DetectedItem, string, error) returning items + status + parse error\n   - ParseJSONLine is not needed for the batch path; streaming still needs line-by-line accumulation (see below)\n3. Streaming consideration: the model will emit the JSON incrementally. Options:\n   a. Buffer the entire JSON response before emitting items (simplest, slight latency increase)\n   b. Stream individual item objects as soon as each complete array element closes (complex but fast)\n   Start with (a) — buffer full JSON, then parse and emit all items at once. Add a TODO for (b).\n4. Update AnalysisResult to include Status string field\n5. Update Analyze() callers (handler_upload.go / area_service.go) to check status and log/skip on non-ok\n6. Update all vision adapter unit tests and service tests\n\n## Acceptance criteria\n- A 'not_food' or 'no_items' response results in zero items written to DB and a clear log message, not a parse error\n- An unparseable response is surfaced as an error, not silently swallowed\n- All existing unit tests pass with updated stubs\n- parse_test.go covers ok, no_items, not_food, unclear, and malformed JSON cases","status":"open","priority":2,"issue_type":"feature","owner":"vbonduro@gmail.com","created_at":"2026-02-21T22:36:38Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T22:36:38Z"}
{"id":"kitchinv-6nr","title":"Automate dev dependency installation","description":"Dev setup currently requires manually installing several tools (Go, Node, golangci-lint, staticcheck, govulncheck, direnv, gitleaks) following README instructions. Find and implement a convenient way to automate this — e.g. a bootstrap script, Makefile target, or tool like mise/asdf — so new contributors and CI can get a working dev environment with a single command. Consider: pinning tool versions, cross-platform support (Linux/macOS), and not conflicting with existing PATH-based tool discovery in the Makefile.","status":"open","priority":3,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-22T16:01:24Z","created_by":"Vincent Bonduro","updated_at":"2026-02-22T16:01:24Z"}
{"id":"kitchinv-72j","title":"Make CI checks runnable locally","description":"## Problem\n\n'make test' (and other make targets) fail locally because the Makefile uses bare 'go'/'golangci-lint' commands but these tools are not on the system PATH. Go lives at ~/.local/bin/go/bin/go and golangci-lint is installed ad-hoc (e.g. /tmp/golangci-bin/golangci-lint). This means developers must remember magic paths to run any check, and there is no parity with CI.\n\n## Goals\n\n1. Fix Makefile so that 'make test', 'make lint', 'make vet', 'make all', etc. all work out of the box locally without remembering non-standard paths.\n2. Provide a way to run the full CI suite locally, ideally in the same environment as GitHub Actions (e.g. via 'act' or a documented Docker-based approach).\n3. The fix should be simple and not require every developer to edit their shell profile.\n\n## Acceptance criteria\n\n- 'make test' passes on a fresh shell (no PATH modifications needed)\n- 'make lint' runs golangci-lint without a manual path prefix\n- A single command (e.g. 'make ci' or 'act') runs all four CI jobs (lint, vet, staticcheck, test) in an environment close to ubuntu-latest\n- README or CLAUDE.md documents how to run CI locally\n\n## Possible approaches\n\n- Detect go binary location in Makefile (GO ?= $(shell which go || echo ~/.local/bin/go/bin/go))\n- Add a 'make ci' target that shells into the project's Docker image or uses 'act' to replay .github/workflows/ci.yml\n- Document 'act' setup (nektos/act) as the canonical local CI runner","status":"closed","priority":2,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-21T15:02:26Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T15:53:22Z","closed_at":"2026-02-21T15:53:22Z","close_reason":"PR #3 opened: https://github.com/vbonduro/kitchinv/pull/3"}
{"id":"kitchinv-73w","title":"Ollama vision adapter","description":"Implement internal/vision/ollama/ollama.go as OllamaAnalyzer implementing VisionAnalyzer. Uses github.com/ollama/ollama/api client. Prompt: 'List every food item you can see in this refrigerator/freezer/pantry photo. For each item provide: name, approximate quantity, and any relevant notes (e.g. opened, expired). Respond in plain text, one item per line, format: name | quantity | notes'. Write ollama_test.go using httptest.NewServer with canned Ollama JSON responses.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:04:43Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:17:18Z","closed_at":"2026-02-20T03:17:18Z","close_reason":"Closed","dependencies":[{"issue_id":"kitchinv-73w","depends_on_id":"kitchinv-wvp","type":"blocks","created_at":"2026-02-19T22:05:26Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-74e","title":"Project scaffold and tooling setup","description":"Initialize the Go module, create the minimal cmd/kitchinv/main.go stub, Makefile, .gitignore, and .golangci.yml. Verify 'make build' produces a binary.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:04:39Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:17:09Z","closed_at":"2026-02-20T03:17:09Z","close_reason":"Closed"}
{"id":"kitchinv-7jm","title":"Create UI mockup screenshots","description":"Create ASCII/text mockups embedded in the README (or as separate docs/screenshots/) showing: the areas list page, the area detail page (with photo + item list), the upload flow, and the search page. These should be realistic representations of the Pico.css + HTMX UI.","status":"closed","priority":2,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:25:43Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:27:00Z","closed_at":"2026-02-20T03:27:00Z","close_reason":"Closed","dependencies":[{"issue_id":"kitchinv-7jm","depends_on_id":"kitchinv-9is","type":"blocks","created_at":"2026-02-19T22:25:49Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-7zx","title":"Service layer: AreaService","description":"Implement internal/service/area_service.go with AreaService struct. Define AreaStorer, ItemStorer, PhotoStorer interfaces within the service package. Key method: ProcessPhoto(ctx, areaID, r, mimeType) which: 1) saves raw bytes to photoStore, 2) inserts photo row, 3) runs vision analysis, 4) calls ReplaceForArea to replace all items for the area. Write area_service_test.go using hand-written testify/mock mocks for all interfaces.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:04:51Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:17:22Z","closed_at":"2026-02-20T03:17:22Z","close_reason":"Closed","dependencies":[{"issue_id":"kitchinv-7zx","depends_on_id":"kitchinv-73w","type":"blocks","created_at":"2026-02-19T22:05:27Z","created_by":"Vincent Bonduro","metadata":"{}"},{"issue_id":"kitchinv-7zx","depends_on_id":"kitchinv-9au","type":"blocks","created_at":"2026-02-19T22:05:27Z","created_by":"Vincent Bonduro","metadata":"{}"},{"issue_id":"kitchinv-7zx","depends_on_id":"kitchinv-dpg","type":"blocks","created_at":"2026-02-19T22:05:27Z","created_by":"Vincent Bonduro","metadata":"{}"},{"issue_id":"kitchinv-7zx","depends_on_id":"kitchinv-siw","type":"blocks","created_at":"2026-02-19T22:05:27Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-86m","title":"Fix CSP: move inline scripts to external files with hashes","description":"Currently all JavaScript is inline (onclick attributes, inline \u003cscript\u003e blocks), which requires 'unsafe-inline' in script-src to work. The proper fix is to move all JS into a separate static .js file served by the app, and either remove the hash requirement (since script-src 'self' covers same-origin files) or add per-script hashes/nonces. This removes the need for 'unsafe-inline' and restores the XSS protection that CSP is meant to provide.","status":"open","priority":3,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-21T20:46:01Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T20:46:01Z"}
{"id":"kitchinv-8lt","title":"Architecture and design review (Ousterhout persona)","description":"## Goal\n\nRun a two-agent design review loop over the kitchinv codebase.\n\n## Process\n\nSpawn two subagents in sequence:\n\n### Agent 1 — Reviewer (John Ousterhout persona)\nAdopt the persona of John Ousterhout, author of *A Philosophy of Software Design*. Apply his specific heuristics when reviewing:\n- Deep modules vs shallow modules (large interface hiding complexity is good; tiny classes/functions that expose their internals are bad)\n- Information hiding — are implementation details leaking through interfaces?\n- Define errors out of existence — are errors surfaced that callers can't reasonably handle?\n- Strategic vs tactical programming — are there signs of tactical complexity (workarounds, special cases, ad-hoc parsing) that a strategic design would eliminate?\n- Comments should describe *why*, not *what* — are there missing or low-value comments?\n- Complexity creep — is the overall system complexity proportional to the problem it solves?\n\nThe reviewer reads all relevant source files, produces a structured written review with:\n1. A brief overall assessment\n2. A prioritised list of findings (each with: location, Ousterhout principle violated, proposed fix)\n3. A list of things done well\n\nThe reviewer writes findings to a temporary review artifact (e.g. a scratch file or structured output returned to the orchestrator).\n\n### Agent 2 — Developer\nReceives the reviewer's findings and implements fixes for each actionable item. For each finding:\n- Decides whether to fix or defer (with rationale)\n- Implements the fix on the current branch\n- Notes what was changed\n\n## Scope\nReview all non-generated Go source under internal/ and cmd/, plus the frontend template. Exclude vendor/, generated files, and test files from the primary review (test files may be noted but are lower priority).\n\n## Acceptance criteria\n- All P0/P1 findings from the review are either fixed or have a documented deferral rationale\n- make all passes after developer agent completes\n- A summary of review findings and resolutions is captured in the bead notes","notes":"## Ousterhout Review Findings\n\n### P0 — Critical\n\n**P0-1: newVisionAnalyzer returns nil on misconfiguration**\n- Location: cmd/kitchinv/main.go\n- Principle: Define errors out of existence\n- Fix: Change return type to (vision.VisionAnalyzer, error), fatal exit in main on error\n- Status: NOT YET IMPLEMENTED\n\n**P0-2: AreaService depends on concrete store types, not interfaces**\n- Location: internal/service/area_service.go\n- Principle: Deep modules; information hiding\n- Fix: Define private areaRepository, photoRepository, itemRepository interfaces in service package; change struct fields to use those interfaces; remove store import\n- Status: NOT YET IMPLEMENTED\n\n### P1 — Important\n\n**P1-1: StreamAnalyzer stale comment references non-existent *StreamError type**\n- Location: internal/vision/vision.go, StreamAnalyzer interface\n- Fix: Update AnalyzeStream doc comment to describe StreamEvent.Err contract accurately\n- Status: NOT YET IMPLEMENTED\n\n**P1-2: Duplicated HTTP request construction in Claude adapter**\n- Location: internal/vision/claude/claude.go\n- Fix: Extract buildMessages() and newHTTPRequest() helpers; add anthropicVersion constant; use in both Analyze and AnalyzeStream\n- Status: NOT YET IMPLEMENTED\n\n**P1-3: Ad-hoc prefix filtering in ParseLine (open-ended heuristic list)**\n- Location: internal/vision/parse.go\n- Fix: Replace HasPrefix block with structural check: require '|' in line to be considered an item\n- Status: NOT YET IMPLEMENTED\n\n**P1-4: web.Server depends on concrete *service.AreaService**\n- Location: internal/web/server.go\n- Fix: Define kitchenService interface in web package; change Server.service field and NewServer param to use it\n- Status: NOT YET IMPLEMENTED\n\n**P1-5: config.Load conflates loading and validation, never returns error**\n- Location: internal/config/config.go\n- Fix: Return (*Config, error); validate CLAUDE_API_KEY when VISION_BACKEND=claude at load time. Resolves root cause of P0-1.\n- Status: NOT YET IMPLEMENTED (deferred — P0-1 fix addresses the symptom sufficiently)\n\n### P2 — Minor\n\n**P2-1: Down migration files embedded/parsed but never executed (dead code)**\n- Location: internal/db/db.go\n- Fix: Add comment 'Only up migrations applied; down migrations not executed. Rollback not supported.'\n- Status: DEFERRED — removing down files would restructure migrations directory convention\n\n**P2-2: logging.New sets global slog default as side effect**\n- Location: internal/logging/logging.go\n- Fix: Remove slog.SetDefault() from New(); call it explicitly in main after logger creation; update comment\n- Status: NOT YET IMPLEMENTED\n\n**P2-3: PhotoStore name collides between photostore pkg (interface) and store pkg (concrete type)**\n- Location: internal/photostore/photostore.go vs internal/store/photo_store.go\n- Fix: Rename photostore.PhotoStore interface to PhotoStorage or PhotoBackend\n- Status: DEFERRED — cosmetic, touches many callsites\n\n**P2-4: Missing 'why' comments on non-obvious decisions**\n- Locations:\n  - internal/db/db.go: explain cache=shared, WAL, foreign_keys DSN options\n  - internal/vision/claude/claude.go: explain MaxTokens: 1024 magic number\n  - internal/vision/claude/claude.go normaliseMIME: explain jpeg fallback rationale\n  - internal/vision/claude/claude.go + ollama/ollama.go: explain channel buffer size 16\n- Status: NOT YET IMPLEMENTED\n\n### Things Done Well (from review)\n- VisionAnalyzer interface is appropriately deep\n- domain/types.go is pure and import-free\n- config.Load is flat and readable\n- ParseResponse/ParseLine are correctly separated\n- photostore.PhotoStore interface is well-scoped\n- db.OpenForTesting is a first-class citizen\n- web handlers are thin and delegate to service","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-21T22:45:57Z","created_by":"Vincent Bonduro","updated_at":"2026-02-22T18:32:01Z","closed_at":"2026-02-22T18:32:01Z","close_reason":"Ousterhout design review complete. All P0/P1 findings implemented, P2s addressed or deferred with rationale. PR #13 merged."}
{"id":"kitchinv-90v","title":"Security vulnerability analysis","description":"Analyze the kitchinv codebase for security vulnerabilities. Areas to cover: (1) dependency audit (govulncheck, nancy, or similar), (2) OWASP top 10 review of HTTP handlers — path traversal, injection, auth, CSRF, (3) file upload handling safety, (4) SQLite query parameterization, (5) environment variable / secret handling (API keys), (6) Docker image security (base image, non-root user, attack surface). Produce a prioritized list of findings and recommended fixes.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-21T04:19:14Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T15:14:02Z","closed_at":"2026-02-21T15:14:02Z","close_reason":"Completed in merged PR #2 (security-fixes branch)"}
{"id":"kitchinv-9au","title":"PhotoStore interface and local filesystem adapter","description":"Create internal/photostore/photostore.go with PhotoStore interface (Save, Get, Delete methods). Implement internal/photostore/local/local.go as LocalPhotoStore storing files at basePath/prefix/\u003cuuid\u003e.\u003cext\u003e. Write local_test.go using t.TempDir() as base path, testing round-trip Save/Get/Delete.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:04:47Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:17:14Z","closed_at":"2026-02-20T03:17:14Z","close_reason":"Closed","dependencies":[{"issue_id":"kitchinv-9au","depends_on_id":"kitchinv-74e","type":"blocks","created_at":"2026-02-19T22:05:26Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-9is","title":"Write README.md","description":"Create a comprehensive README.md for the kitchinv project. Should cover: what the project is and why it exists, architecture overview, environment variable config table, deployment with docker-compose (including pulling the Ollama model), switching to Claude backend, local development setup, make targets, and project directory structure.","status":"closed","priority":2,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:25:37Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:26:56Z","closed_at":"2026-02-20T03:26:56Z","close_reason":"Closed"}
{"id":"kitchinv-9yy","title":"Add govulncheck to CI pipeline","description":"Add govulncheck as a CI job in .github/workflows/ci.yml to automatically scan for known Go vulnerabilities on every push/PR. This ensures dependency vulnerabilities are caught early.","status":"closed","priority":2,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-21T14:33:36Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T15:14:02Z","closed_at":"2026-02-21T15:14:02Z","close_reason":"Completed in merged PR #2 (security-fixes branch)"}
{"id":"kitchinv-af7","title":"Define deployment target and strategy","description":"The Docker publish workflow (docker-publish.yml) builds and pushes to GHCR on version tags but there is no deployment target defined. Decide on and implement a deployment strategy.\n\nOptions to evaluate:\n- Self-hosted VPS (fly.io, Railway, Render, or a raw VM): simple for a personal project, matches the existing Docker setup\n- GitHub Actions deploy step after publish: ssh + docker pull, or platform-specific deploy action\n- Staging vs production environments: determines whether E2E tests run against a real deployed instance or a CI-ephemeral container\n\nConsiderations:\n- E2E tests (kitchinv-dls, kitchinv-v9c) can run against an ephemeral Docker container in CI without a staging environment, so deployment is not a blocker for E2E testing\n- A deployment target would unlock post-deploy smoke tests and real-world validation with an actual vision backend\n- Versioning/semver (kitchinv-3to) should be settled first since the publish workflow is tag-triggered","status":"open","priority":3,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-22T13:30:36Z","created_by":"Vincent Bonduro","updated_at":"2026-02-22T13:30:36Z"}
{"id":"kitchinv-axa","title":"Database layer: migrations and db.go","description":"Write the 3 SQL migration pairs in internal/db/migrations/ (areas, photos, items tables). Implement internal/db/db.go: open modernc.org/sqlite, enable WAL mode and foreign keys via DSN pragmas, run migrations via golang-migrate with iofs source. Write db_test.go using :memory: SQLite to verify migrations apply and roll back.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:04:39Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:17:14Z","closed_at":"2026-02-20T03:17:14Z","close_reason":"Closed","dependencies":[{"issue_id":"kitchinv-axa","depends_on_id":"kitchinv-74e","type":"blocks","created_at":"2026-02-19T22:05:26Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-b9d","title":"Design health-check API endpoint","description":"Design the /health or /api/status endpoint that checks whether the configured vision backend is reachable. Define the response shape (JSON), what constitutes 'healthy' for Ollama vs Claude backends, and any timeout/error handling considerations. No code yet — just the design spec.","status":"open","priority":2,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-21T03:51:46Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T03:51:46Z","dependencies":[{"issue_id":"kitchinv-b9d","depends_on_id":"kitchinv-gf0","type":"blocks","created_at":"2026-02-20T22:51:56Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-bka","title":"Implement vision status monitor","description":"Implement the health-check API endpoint and frontend status indicator per the designs in kitchinv-36v and kitchinv-b9d. Includes: Go handler for the status endpoint, VisionAnalyzer health-check method or equivalent, HTMX polling in the banner, and CSS for the indicator states.","status":"open","priority":2,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-21T03:51:52Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T03:51:52Z","dependencies":[{"issue_id":"kitchinv-bka","depends_on_id":"kitchinv-36v","type":"blocks","created_at":"2026-02-20T22:51:55Z","created_by":"Vincent Bonduro","metadata":"{}"},{"issue_id":"kitchinv-bka","depends_on_id":"kitchinv-b9d","type":"blocks","created_at":"2026-02-20T22:51:55Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-bzc","title":"Add structured logging with log file support","description":"Currently the server only logs to stdout with log.Printf. There is no log file, no request tracing, and no way to diagnose issues after the fact. Add structured logging (e.g. log/slog) with: (1) configurable log level via env var, (2) log file output in addition to stderr, (3) per-request trace logging (method, path, status, duration), (4) enough context in error logs to diagnose failures without needing a debugger.","status":"closed","priority":1,"issue_type":"feature","owner":"vbonduro@gmail.com","created_at":"2026-02-21T20:42:09Z","created_by":"Vincent Bonduro","updated_at":"2026-02-22T00:08:24Z","closed_at":"2026-02-22T00:08:24Z","close_reason":"Implemented and merged in PR #7"}
{"id":"kitchinv-dhk","title":"Clean up README.md","description":"The README.md needs cleanup: remove the ASCII screenshots and add badges for Go Report Card and code coverage.","status":"closed","priority":3,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:44:56Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T20:58:53Z","closed_at":"2026-02-21T20:58:53Z","close_reason":"PR #6 merged"}
{"id":"kitchinv-dls","title":"Add end-to-end automated tests","description":"Write E2E tests that drive a real browser against a running kitchinv instance. Evaluate Playwright or chromedp. Cover key user flows: add an area, upload a photo, verify items appear, search for an item, navigate to area from search result, delete an area. Should run in CI using a mock vision backend to avoid Ollama/Claude dependency.\n\n## Frontend/browser bugs caught during manual testing (kitchinv-5mw)\n\nThese were found during a live mobile testing session and require a real browser to reproduce:\n\n1. **Mobile file picker not opening**: The original design hid the file input with `position: absolute; width: 1px; height: 1px` inside a `\u003clabel\u003e` wrapper, relying on implicit label/input association. On mobile browsers this silently failed — tapping the label did not open the file picker. Fixed by replacing with a plain visible `input[type=\"file\"]` and removing the global `display: none` CSS that was hiding it. An E2E test in mobile viewport (e.g. Playwright's iPhone emulation) should tap the \"Choose photo\" element and assert the file chooser is triggered.\n\n2. **capture=\"environment\" forcing camera**: The `capture` attribute bypassed the camera/library sheet on iOS, confusing users who wanted to upload an existing photo. Removed. E2E test: assert no `capture` attribute on the file input.\n\n3. **Context cancellation killing Ollama on navigation**: When the user navigated away mid-stream, the browser cancelled the fetch, which cancelled the HTTP request context, which killed the Ollama API call. Fixed by using `context.WithoutCancel` for the vision analysis call so it runs to completion regardless of client disconnect. E2E test: start upload, navigate away immediately, return — assert items eventually appear (requires slow mock vision backend).\n\n4. **sessionStorage unreliable on mobile Safari**: The original navigation-resilience approach wrote a key to sessionStorage on stream start and read it on page load to resume the scanning state. Mobile Safari (and bfcache behaviour) made this unreliable — the key was never read back. Fixed by removing sessionStorage entirely: the server-rendered template now exposes whether a photo exists with no items, and the page polls /areas/{id}/items automatically in that state. E2E test: assert that returning to an area page mid-analysis shows the scanning spinner without any client-side state.\n\n5. **Areas list page not reflecting analysis state**: The area card on the main /areas page showed \"No items\" even when analysis was in progress. Fixed by adding a third template branch: photo present + no items → show \"Analysing…\" in accent colour. E2E test: after starting analysis and navigating to /areas, assert the card shows \"Analysing\" rather than the no-items message.\n\n## Tool recommendation\n\nNode v22 is already installed. Options:\n- Playwright: real browser (Chromium/Firefox/WebKit), can test file input, fetch/ReadableStream, navigation, and mobile viewport emulation. Covers all bugs above.\n- Vitest + jsdom: unit-tests extracted JS functions, fast, no browser. Cannot reproduce any of the mobile-specific bugs above.\n- Playwright is clearly the right choice given the mobile-specific nature of the bugs found.\n\n## Key flows to cover\n\n- Add an area\n- Upload a photo (file picker opens, file selected, Analyse clicked)\n- Verify items appear on the area detail page\n- Navigate away mid-analysis, return, verify scanning spinner shown and items appear\n- Navigate to /areas mid-analysis, verify card shows Analysing\n- Search for an item\n- Delete an area","notes":"# Plan: Add Playwright E2E Tests (kitchinv-dls)\n\n## Context\n\nkitchinv has Go integration tests covering server-side logic, but no browser-level tests. During mobile testing, several bugs were found that required a real browser to reproduce (file picker, HTMX navigation, SSE streaming, polling). The goal is a Playwright E2E suite that runs headless from SSH and in CI, using a mock Ollama server instead of a real vision model.\n\nAll tests are headless — no headed tests needed. Every bug in the issue is reproducible headless.\n\n---\n\n## Directory Structure\n\n```\ne2e/\n  package.json\n  package-lock.json          # committed; CI uses npm ci\n  playwright.config.ts\n  global-setup.ts\n  global-teardown.ts\n  mock-ollama.js             # Node.js HTTP server faking Ollama API\n  .gitignore                 # node_modules/, playwright-report/, test-results/\n  tests/\n    areas.spec.ts            # add, list, delete area\n    upload.spec.ts           # upload photo, items stream in, button state\n    navigation.spec.ts       # mid-analysis navigation bugs\n    search.spec.ts           # search flow, navigate from result\n    regression.spec.ts       # mobile file picker, no capture attr, no sessionStorage\n```\n\n---\n\n## Mock Ollama Server (`e2e/mock-ollama.js`)\n\nThe Ollama adapter (`internal/vision/ollama/ollama.go`) POSTs to `/api/generate` with `stream: true` and reads NDJSON. Each line: `{\"response\":\"\u003ctoken\u003e\",\"done\":false}`. The adapter accumulates tokens until it sees `\\n`, then parses the line as `name | qty | notes`.\n\nConfirmed from `ollama_test.go`:\n```js\n// Pattern the mock must replicate exactly:\n{\"response\": \"Milk | 1 liter | opened\", \"done\": false}\n{\"response\": \"\\n\", \"done\": false}\n{\"response\": \"Butter | 1 block |\", \"done\": false}\n{\"response\": \"\\n\", \"done\": true}\n```\n\nMock items (fast mode, returned immediately):\n- `Milk | 2 liters | semi-skimmed`\n- `Butter | 1 block | opened`\n- `Orange Juice | 1 carton |`\n\n**Slow mode**: triggered by `X-Mock-Slow: true` request header. Delays 500ms between items. Used for navigation/mid-analysis tests via Playwright `page.route()` header injection.\n\nMock also handles:\n- `GET /` → 200 (health check for `waitForPort`)\n- `POST /api/generate` with `stream: false` → single JSON response (for non-streaming path)\n- `Content-Type: application/x-ndjson` on streaming response; must flush each line with `res.write()`\n\n---\n\n## Global Setup (`e2e/global-setup.ts`)\n\n1. `execSync('make build', { cwd: ROOT })` — builds `./kitchinv` binary (Makefile handles Go path discovery)\n2. `fs.mkdtempSync(...)` — creates temp dir for SQLite DB and photos\n3. Spawn `node e2e/mock-ollama.js` with `MOCK_OLLAMA_PORT=19434`\n4. Spawn `./kitchinv` with env:\n   ```\n   LISTEN_ADDR=:9090\n   DB_PATH=\u003ctmpdir\u003e/kitchinv.db\n   PHOTO_LOCAL_PATH=\u003ctmpdir\u003e/photos\n   VISION_BACKEND=ollama\n   OLLAMA_HOST=http://localhost:19434\n   OLLAMA_MODEL=moondream\n   ```\n5. `waitForPort(19434)` then `waitForPort(9090)` — polls HTTP until 200/redirect received\n6. Write PIDs and tmpdir path to `/tmp/kitchinv-e2e-*.pid` files for teardown\n\n**`waitForPort`**: retries `http.get` every 200ms, rejects after 15s. Any HTTP response (including 303 redirect from `/` → `/areas`) counts as ready.\n\n## Global Teardown (`e2e/global-teardown.ts`)\n\nReads PID files, sends `SIGTERM`, deletes temp dir with `fs.rmSync(..., { recursive: true })`.\n\n---\n\n## `e2e/playwright.config.ts`\n\n```\nbaseURL: http://localhost:9090\nheadless: true\ntimeout: 30_000\nactionTimeout: 10_000\nretries: 0\nworkers: CI ? 2 : undefined   (limits SQLite contention in CI)\nreporter: CI ? 'github' : 'list'\ntrace: 'on-first-retry'\nscreenshot: 'only-on-failure'\n\nprojects:\n  - chromium (Desktop Chrome) — used by all spec files\n  - mobile-chrome (iPhone 14) — used by regression.spec.ts mobile test via test.use()\n```\n\n---\n\n## Test Isolation Strategy\n\nAll tests share one running server + SQLite DB. Each test creates its own uniquely named area and filters all assertions by that name. No shared state, no cleanup needed between tests.\n\nPattern used everywhere:\n```ts\nconst name = 'E2E \u003cTestName\u003e';\n// create area named `name`\n// assert on locator('.area-row', { has: locator containing name })\n```\n\n---\n\n## `e2e/package.json`\n\n```json\n{\n  \"name\": \"kitchinv-e2e\",\n  \"version\": \"1.0.0\",\n  \"private\": true,\n  \"scripts\": { \"test\": \"playwright test\" },\n  \"devDependencies\": { \"@playwright/test\": \"^1.44.0\" }\n}\n```\n\n---\n\n## Test File Summaries\n\n### `tests/areas.spec.ts`\n- Empty areas list on first load → `.empty-state` visible\n- Add area → appears in `.area-row-name a`\n- Add area → click link → `.detail-title` matches name\n- Delete area → `page.on('dialog', d =\u003e d.accept())` → redirects to `/areas`, card gone\n- Two areas → `.area-row` count = 2\n\n**Key**: `createArea(page, name)` helper: `goto('/areas')` → `click('#menu-btn')` → `fill('input[name=\"name\"]')` → `click('button[type=\"submit\"]')` → wait for `.area-row-name a` with that text. Must always start from `/areas` because HTMX target `.area-list` only exists there.\n\n### `tests/upload.spec.ts`\n- Upload triggers file chooser: `Promise.all([page.waitForEvent('filechooser'), page.click('#photo-input')])`\n- Scanning indicator `.analyse-scanning` appears immediately after submit\n- 3 `.item-row` elements appear after stream completes (fast mock)\n- Button `#upload-btn` is disabled during upload, re-enabled after\n- Second upload replaces items (still 3 `.item-row` after)\n\n**JPEG fixture**: 512-byte buffer with `0xFF 0xD8 0xFF 0xE0` magic bytes. Written to tmp file via `fs.writeFileSync`. Server validates magic bytes — zero-byte file returns 400.\n\n### `tests/navigation.spec.ts`\n\nAll tests inject slow header before upload:\n```ts\nawait page.route('**/photos/stream', async route =\u003e {\n  const headers = { ...route.request().headers(), 'x-mock-slow': 'true' };\n  await route.continue({ headers });\n});\n```\n\n**Test 1 — navigate away mid-stream, return, spinner shows then items appear:**\n1. Upload with slow mock\n2. Wait for `.analyse-scanning` (stream started)\n3. `goto('/areas')` — disconnects browser from SSE stream\n4. Click back to area detail\n5. Server-rendered page: photo exists, no items → JS sets `.analyse-scanning`, starts polling\n6. `waitFor('.item-row', count: 3, timeout: 20_000)` — polling picks up items after analysis completes server-side\n\n**Test 2 — \"Analysing...\" card on /areas during analysis:**\n1. Upload with slow mock\n2. Wait for `.analyse-scanning`\n3. `goto('/areas')`\n4. Assert `card.locator('.area-row-analysing')` visible within 5s\n5. Assert `.area-row-no-items` not visible\n\n**Test 3 — items appear after navigation (context.WithoutCancel):**\n1. Upload with slow mock, navigate away immediately\n2. `waitForTimeout(2000)` — let slow mock finish (3 items × 500ms = 1.5s)\n3. Navigate back, assert 3 `.item-row` elements (items came from DB, not SSE stream)\n\n### `tests/search.spec.ts`\n\nHelper `createAreaWithItems(page, name)`: create area + upload fixture + wait for 3 `.item-row`.\n\n- Search 'Milk' → `.result-card` with 'Milk' visible within 5s\n- Search result has `.result-area-link` ('View area')\n- Click 'View area' → URL matches `/areas/\\d+`, `.detail-title` contains area name\n- Search unknown term → `.empty-state` visible\n- Search lowercase 'milk' finds 'Milk' (case-insensitive DB query)\n\n### `tests/regression.spec.ts`\n\n**Bug 1 — No `capture` attribute:**\n```ts\nconst attr = await page.locator('#photo-input').getAttribute('capture');\nexpect(attr).toBeNull();\n```\n\n**Bug 2 — Mobile file picker opens:**\n```ts\ntest.use({ ...devices['iPhone 14'] });\nconst [fc] = await Promise.all([\n  page.waitForEvent('filechooser', { timeout: 5_000 }),\n  page.locator('#photo-input').tap(),\n]);\nexpect(fc).toBeTruthy();\n```\n\n**Bug 3 — No sessionStorage (server-rendered spinner):**\n1. Start upload with slow mock, wait for `.analyse-scanning`\n2. Get current URL\n3. `goto('/areas')`\n4. Open fresh page in same context: `page.context().newPage()`\n5. Fresh page navigates to area URL\n6. Assert `.analyse-scanning` visible (server-rendered: `hasPhoto \u0026\u0026 !hasItems`)\n7. Assert `Object.keys(sessionStorage).length === 0`\n\n**Bug 4 — \"Analysing...\" not \"No items\" on areas list:**\nSame as navigation.spec.ts Test 2, but as an explicit regression assertion with both positive (`.area-row-analysing` visible) and negative (`.area-row-no-items` not visible) assertions.\n\n---\n\n## Makefile Addition\n\n```makefile\n# ---------------------------------------------------------------------------\n# E2E tests\n# ---------------------------------------------------------------------------\ne2e:\n\tcd e2e \u0026\u0026 npm install --prefer-offline \u0026\u0026 npx playwright install --with-deps chromium \u0026\u0026 npx playwright test\n\ne2e-headed:\n\tcd e2e \u0026\u0026 npm install --prefer-offline \u0026\u0026 npx playwright test --headed\n```\n\nAdd `e2e` to `.PHONY`.\n\n---\n\n## CI Addition (`.github/workflows/ci.yml`)\n\nNew job, parallel to existing five:\n\n```yaml\ne2e:\n  name: E2E Tests\n  runs-on: ubuntu-latest\n  steps:\n    - uses: actions/checkout@v4\n    - uses: actions/setup-go@v5\n      with:\n        go-version-file: go.mod\n        cache: true\n    - uses: actions/setup-node@v4\n      with:\n        node-version: '22'\n        cache: 'npm'\n        cache-dependency-path: e2e/package-lock.json\n    - name: Install Playwright\n      run: cd e2e \u0026\u0026 npm ci \u0026\u0026 npx playwright install --with-deps chromium\n    - name: Run E2E tests\n      run: cd e2e \u0026\u0026 npx playwright test\n      env:\n        APP_PORT: '9090'\n        OLLAMA_PORT: '19434'\n        CI: 'true'\n    - name: Upload report\n      if: always()\n      uses: actions/upload-artifact@v4\n      with:\n        name: playwright-report\n        path: e2e/playwright-report/\n        retention-days: 7\n    - name: Upload traces\n      if: failure()\n      uses: actions/upload-artifact@v4\n      with:\n        name: playwright-traces\n        path: e2e/test-results/\n        retention-days: 7\n```\n\n**Note**: `npx playwright install --with-deps chromium` installs Chromium system dependencies via apt on ubuntu-latest (requires sudo, available on GH runners).\n\n---\n\n## Gotchas\n\n1. **`make build` in global-setup**: The Makefile uses `$(GO)` which auto-discovers Go path. Ensure the CI `setup-go` step runs before the E2E job, or that Go is on PATH in `global-setup.ts`.\n\n2. **HTMX `hx-target=\".area-list\"`**: The \"Add area\" form only works correctly when `.area-list` exists in the DOM (i.e., on `/areas` page). `createArea` must always `goto('/areas')` first.\n\n3. **2-second polling delay**: The polling JS waits 2s before first poll. Navigation tests that depend on polling need `timeout: 20_000`.\n\n4. **`page.route()` and fetch interception**: Playwright intercepts `fetch()` calls from the page (not just navigations). `route.continue({ headers })` correctly merges the `X-Mock-Slow` header.\n\n5. **`hx-confirm` dialog**: HTMX uses native `window.confirm`. Register `page.on('dialog', d =\u003e d.accept())` before clicking delete.\n\n6. **`package-lock.json` must be committed**: CI uses `npm ci`.\n\n7. **Port choices**: 9090 (app) and 19434 (mock Ollama) are uncommon enough to avoid CI conflicts.\n\n---\n\n## Critical Files\n\n- `internal/vision/ollama/ollama.go` — confirms NDJSON streaming format for mock\n- `internal/vision/ollama/ollama_test.go` — confirms exact chunk pattern\n- `internal/web/templates/pages/area_detail.html` — all key selectors + JS logic\n- `internal/web/templates/partials/area_card.html` — `.area-row-analysing` template branch\n- `internal/web/templates/base.html` — dropdown form structure, HTMX targets\n- `internal/web/templates/partials/search_results.html` — `.result-card`, `.result-area-link`\n- `Makefile` — binary output location (`-o kitchinv`), Go tool discovery pattern","status":"closed","priority":2,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-21T04:22:05Z","created_by":"Vincent Bonduro","updated_at":"2026-02-22T16:16:00Z","closed_at":"2026-02-22T16:16:00Z","close_reason":"Implemented: 26 Playwright E2E tests merged via PR #11"}
{"id":"kitchinv-dpg","title":"Domain types and store layer","description":"Create internal/domain/types.go with Area, Photo, Item structs. Implement internal/store/area_store.go, item_store.go, photo_store.go as thin wrappers around database/sql. item_store must include a Search method using LIKE on items.name COLLATE NOCASE. Write store tests using in-memory SQLite.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:04:40Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:17:18Z","closed_at":"2026-02-20T03:17:18Z","close_reason":"Closed","dependencies":[{"issue_id":"kitchinv-dpg","depends_on_id":"kitchinv-axa","type":"blocks","created_at":"2026-02-19T22:05:26Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-fa6","title":"HTTP handlers and server wiring","description":"Create internal/web/server.go (ServeMux routing + logging/recovery middleware). Create handler_area.go (list, create, detail, delete area), handler_upload.go (POST /areas/{id}/photos multipart upload), handler_search.go (GET /search with q param). All handlers detect HX-Request: true header and return partial vs full page accordingly. Routes: GET /areas, POST /areas, GET /areas/{id}, POST /areas/{id}/photos, GET /areas/{id}/photo, DELETE /areas/{id}, GET /search. Write handler tests using httptest.NewRecorder + mock service.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:04:59Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:17:25Z","closed_at":"2026-02-20T03:17:25Z","close_reason":"Closed","dependencies":[{"issue_id":"kitchinv-fa6","depends_on_id":"kitchinv-7zx","type":"blocks","created_at":"2026-02-19T22:05:27Z","created_by":"Vincent Bonduro","metadata":"{}"},{"issue_id":"kitchinv-fa6","depends_on_id":"kitchinv-t2m","type":"blocks","created_at":"2026-02-19T22:05:28Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-gf0","title":"Add vision system status monitor to UI","description":"Add a status indicator to the website showing whether the vision backend (Ollama/Claude) is currently reachable and ready. This involves three phases: (1) design the frontend indicator in the banner, (2) design the health-check API endpoint, (3) implement both end-to-end.","status":"open","priority":2,"issue_type":"feature","owner":"vbonduro@gmail.com","created_at":"2026-02-21T03:51:15Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T03:51:15Z"}
{"id":"kitchinv-l1q","title":"Review unit tests for behaviour-based coverage","description":"Audit all existing unit tests to ensure they test observable behaviour rather than implementation details. Identify tests that are brittle (testing internal state, private methods, or exact call sequences) and refactor them to test outcomes. Also identify any gaps where behaviour is untested. Deliverable: refactored tests + a short summary of what was changed and what gaps remain.","status":"closed","priority":2,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-21T04:19:56Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T20:20:38Z","closed_at":"2026-02-21T20:20:38Z","close_reason":"Tests refactored and coverage gaps filled. PR #4 merged."}
{"id":"kitchinv-oeb","title":"Add Docker publish workflow for container registry","description":"Create a GitHub Actions workflow to build and publish the Docker container to a container registry (GitHub Container Registry / ghcr.io) on push to main or on tag/release. Should use the existing Dockerfile and multi-stage build.","status":"closed","priority":1,"issue_type":"feature","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:28:23Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:29:30Z","closed_at":"2026-02-20T03:29:30Z","close_reason":"Created .github/workflows/docker-publish.yml publishing to ghcr.io on push to main and version tags"}
{"id":"kitchinv-oeq","title":"Use pre-commit to manage git hooks","description":"Currently the gitleaks pre-commit hook is installed manually into .git/hooks/pre-commit, which means new contributors (and new worktrees) have to set it up themselves. Switch to pre-commit (https://pre-commit.com) to manage hooks declaratively via a committed .pre-commit-config.yaml. This makes hook installation a single command ('pre-commit install') and ensures everyone on the project runs the same checks. The gitleaks hook should be migrated to use the official gitleaks pre-commit hook (https://github.com/gitleaks/gitleaks). Consider also adding other useful hooks like trailing-whitespace, end-of-file-fixer, and check-yaml from pre-commit-hooks.","status":"open","priority":3,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-21T21:15:03Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T21:15:03Z"}
{"id":"kitchinv-orp","title":"Wire cmd/kitchinv/main.go","description":"Complete cmd/kitchinv/main.go with full dependency injection: load config, open DB, create stores, select vision adapter based on VISION_BACKEND env var (ollama default, claude alternative), select photo store based on PHOTO_BACKEND env var, construct AreaService, construct and start HTTP server. Smoke test: run locally with VISION_BACKEND=ollama, open browser, verify UI works end to end.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:05:02Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:17:27Z","closed_at":"2026-02-20T03:17:27Z","close_reason":"Closed","dependencies":[{"issue_id":"kitchinv-orp","depends_on_id":"kitchinv-44t","type":"blocks","created_at":"2026-02-19T22:05:28Z","created_by":"Vincent Bonduro","metadata":"{}"},{"issue_id":"kitchinv-orp","depends_on_id":"kitchinv-fa6","type":"blocks","created_at":"2026-02-19T22:05:28Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-qcv","title":"Update photo display immediately on upload (before analysis completes)","description":"Currently the photo only appears after a full round-trip. As soon as the user selects a file and hits Analyse, the photo should update in the UI immediately using a local object URL (URL.createObjectURL), before the server responds. This improves perceived responsiveness.","status":"open","priority":2,"issue_type":"feature","owner":"vbonduro@gmail.com","created_at":"2026-02-21T03:55:38Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T03:55:38Z"}
{"id":"kitchinv-s04","title":"Add integration tests","description":"Write integration tests that exercise multiple layers together (e.g. HTTP handler + service + real SQLite DB). Use httptest.Server to test full request/response cycles for key flows: create area, upload photo, list items, search, delete area. Tests should run in CI without external dependencies.","notes":"IMPORTANT: The stream endpoint integration test must include a case that sends a real multipart/form-data POST with a non-empty JPEG (or similar image file) to POST /areas/{id}/photos/stream and asserts that the vision adapter receives non-zero image bytes. This catches the regression where FormData was constructed after fileInput was disabled — causing the browser to silently exclude the disabled input, so the server received an empty image. The test should use httptest.Server + a stub StreamAnalyzer that records the image bytes it was called with, and assert len(imageData) \u003e 0.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-21T04:22:05Z","created_by":"Vincent Bonduro","updated_at":"2026-02-22T01:47:10Z","closed_at":"2026-02-22T01:47:10Z","close_reason":"Integration tests implemented and merged via PR #8"}
{"id":"kitchinv-s7p","title":"Add code coverage reporting with Codecov on CI","description":"Integrate code coverage reporting into the CI pipeline. Run tests with coverage on every PR, upload results to Codecov, and add a coverage badge to the README. Configure minimum coverage thresholds to fail PRs that drop coverage.","status":"open","priority":2,"issue_type":"feature","owner":"vbonduro@gmail.com","created_at":"2026-02-21T04:22:05Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T04:22:05Z"}
{"id":"kitchinv-sfm","title":"Fix flaky E2E tests: race between client spinner and server photo commit","description":"Tests that check .analyse-scanning before navigating away have a race condition: the spinner appears immediately in JS (before the server even receives the upload), but the test navigates away expecting the photo to already be in the DB. Fix: wait for the /photos/stream response to start before navigating, since the server only responds after committing the photo.","status":"closed","priority":1,"issue_type":"bug","owner":"vbonduro@gmail.com","created_at":"2026-02-22T20:29:53Z","created_by":"Vincent Bonduro","updated_at":"2026-02-22T21:19:46Z","closed_at":"2026-02-22T21:19:46Z","close_reason":"Fixed via PR #14, merged"}
{"id":"kitchinv-siw","title":"Claude vision adapter","description":"Implement internal/vision/claude/claude.go as ClaudeAnalyzer implementing VisionAnalyzer. Uses github.com/liushuangls/go-anthropic/v2. Sends image as base64 content block. Same structured prompt as Ollama adapter, same parseResponse helper. Write claude_test.go using httptest.NewServer with canned Anthropic API JSON responses.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:04:45Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:17:18Z","closed_at":"2026-02-20T03:17:18Z","close_reason":"Closed","dependencies":[{"issue_id":"kitchinv-siw","depends_on_id":"kitchinv-wvp","type":"blocks","created_at":"2026-02-19T22:05:26Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-syg","title":"Display inventory list as a table per area","description":"Change the inventory list view for each area from a plain list into a table format. The table should display relevant item fields (name, quantity, unit, etc.) in a structured, scannable layout.","status":"in_progress","priority":2,"issue_type":"feature","owner":"vbonduro@gmail.com","created_at":"2026-02-22T02:33:51Z","created_by":"Vincent Bonduro","updated_at":"2026-02-22T22:21:29Z"}
{"id":"kitchinv-t2m","title":"HTML templates","description":"Create all templates in internal/web/templates/. Structure: base.html (full page layout with Pico.css CDN + HTMX CDN), partials/area_card.html, partials/area_list.html, partials/item_list.html, partials/search_results.html, pages/areas.html, pages/area_detail.html, pages/search.html. Create embed.go with //go:embed directive. Key mobile feature: file input must use accept='image/*' capture='environment' to open rear camera. Write a test verifying templates parse without error.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:04:54Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:17:14Z","closed_at":"2026-02-20T03:17:14Z","close_reason":"Closed","dependencies":[{"issue_id":"kitchinv-t2m","depends_on_id":"kitchinv-74e","type":"blocks","created_at":"2026-02-19T22:05:27Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-tph","title":"Add CI pipeline: lint, static analysis, code coverage on push","description":"Create a GitHub Actions workflow that runs on every push and PR. Should run: golangci-lint (configured via .golangci.yml), go vet, staticcheck, and go test with -race -coverprofile to compute code coverage.","status":"closed","priority":1,"issue_type":"feature","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:28:22Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:29:30Z","closed_at":"2026-02-20T03:29:30Z","close_reason":"Created .github/workflows/ci.yml with lint, vet, staticcheck, and test+coverage jobs"}
{"id":"kitchinv-v9c","title":"Add E2E tests to CI pipeline","description":"Run Playwright E2E tests in CI against a containerised kitchinv instance, using a mock vision backend so there is no Ollama/Claude dependency.\n\nThe existing Dockerfile and docker-compose.yml provide a good starting point. The CI job should:\n- Build the Docker image\n- Start kitchinv with VISION_BACKEND=stub (or similar mock) and an in-memory/temp DB\n- Run Playwright tests against it\n- Tear down on completion\n\nThis job can run on every PR alongside the existing lint/test jobs, or only on merge to main to keep PR feedback fast. Depends on kitchinv-dls (E2E test suite) existing first.\n\nSee kitchinv-dls for Playwright vs Vitest tradeoff notes and specific bugs (photo preview onchange, mid-stream navigation) that require a real browser to catch.","status":"open","priority":3,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-22T13:30:25Z","created_by":"Vincent Bonduro","updated_at":"2026-02-22T13:30:25Z","dependencies":[{"issue_id":"kitchinv-v9c","depends_on_id":"kitchinv-dls","type":"blocks","created_at":"2026-02-22T08:30:39Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-wl7","title":"Fix CI running twice (on push and PR)","description":"CI checks are triggered twice — once for push events and once for pull_request events. When a PR is open, the push-triggered run is redundant. Fix the GitHub Actions workflow to only run once per PR/push, e.g. by limiting push triggers to main only and using pull_request for feature branches, or by using the 'push' event only when there is no associated PR.","status":"closed","priority":2,"issue_type":"bug","owner":"vbonduro@gmail.com","created_at":"2026-02-21T20:58:27Z","created_by":"Vincent Bonduro","updated_at":"2026-02-22T16:50:09Z","closed_at":"2026-02-22T16:50:09Z","close_reason":"Fixed: push trigger limited to main, removed spurious playwright-report upload step. PR #12 merged."}
{"id":"kitchinv-wvp","title":"VisionAnalyzer interface and parse helper","description":"Create internal/vision/vision.go with VisionAnalyzer interface, AnalysisResult and DetectedItem types. Create internal/vision/parse.go with shared parseResponse(raw string) []DetectedItem helper that splits lines on '|' (name|quantity|notes format). Write table-driven parse_test.go covering edge cases: empty response, missing pipes, extra whitespace.","status":"closed","priority":1,"issue_type":"task","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:04:40Z","created_by":"Vincent Bonduro","updated_at":"2026-02-20T03:17:14Z","closed_at":"2026-02-20T03:17:14Z","close_reason":"Closed","dependencies":[{"issue_id":"kitchinv-wvp","depends_on_id":"kitchinv-74e","type":"blocks","created_at":"2026-02-19T22:05:26Z","created_by":"Vincent Bonduro","metadata":"{}"}]}
{"id":"kitchinv-z6k","title":"Fix linting CI check","description":"The linting CI check is not currently working and needs to be fixed. Investigate the CI configuration and linting setup to identify the issue and resolve it so the lint check passes in CI.","status":"closed","priority":1,"issue_type":"bug","owner":"vbonduro@gmail.com","created_at":"2026-02-20T03:44:56Z","created_by":"Vincent Bonduro","updated_at":"2026-02-21T15:11:20Z","closed_at":"2026-02-21T15:11:20Z","close_reason":"PR #1 merged"}
